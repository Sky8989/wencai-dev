<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.1//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sftc.web.mapper.OrderExpressMapper">

    <resultMap id="orderExpressMap" type="com.sftc.web.model.OrderExpress" >
        <id column="id" property="id" />
        <result column="order_number" property="order_number" />
        <result column="ship_name" property="ship_name" />
        <result column="ship_mobile" property="ship_mobile" />
        <result column="ship_province" property="ship_province" />
        <result column="ship_city" property="ship_city" />
        <result column="ship_area" property="ship_area" />
        <result column="ship_addr" property="ship_addr" />
        <result column="package_type" property="package_type" />
        <result column="object_type" property="object_type" />
        <result column="create_time" property="create_time" />
        <result column="is_use" property="is_use" />
    </resultMap>

    <select id="selectExpressForId" parameterType="int" resultType="com.sftc.web.model.OrderExpress">
        SELECT uuid FROM sftc_order_express WHERE (sender_user_id=#{id} or ship_user_id=#{id})
    </select>

    <!-- 根据订单编号查询该订单的包裹 -->
    <select id="findEmptyPackage" resultMap="orderExpressMap" parameterType="java.lang.String">
        SELECT * FROM sftc_order_express WHERE order_number=#{order_number} AND is_use=0
    </select>

    <select id="findMyOrderExpress" parameterType="com.sftc.web.model.OrderExpress"
            resultType="com.sftc.web.model.apiCallback.OrderCallback">
        SELECT DISTINCT sftc_order_express.id,sftc_order_express.order_number,sftc_order_express.ship_name,
        sftc_order_express.ship_addr,sftc_order_express.state,
        sftc_order.sender_name,sftc_order.sender_addr
        FROM sftc_order_express,sftc_order
        WHERE (sftc_order_express.sender_user_id=#{id} or sftc_order_express.ship_user_id=#{id})
        AND sftc_order_express.order_id = sftc_order.id
        <if test="state!=null">
            AND sftc_order_express.state=#{state}
        </if>
    </select>

    <!-- 普通下单 -->
    <insert id="addOrderExpress" parameterType="com.sftc.web.model.OrderExpress">
        INSERT INTO sftc_order_express
        (ship_name,ship_mobile,ship_province,ship_city,ship_area,
        ship_addr,order_number,package_type,object_type,create_time,sender_user_id,order_id,state,uuid,longitude,latitude)
        VALUES
        (#{ship_name},#{ship_mobile},#{ship_province},#{ship_city},#{ship_area},
        #{ship_addr},#{order_number},#{package_type},#{object_type},#{create_time},#{sender_user_id},#{order_id},#{state}
        ,#{uuid},#{longitude},#{latitude})
    </insert>

    <update id="updateOrderExpress" parameterType="com.sftc.web.model.OrderExpress">
        UPDATE sftc_order_express
        set
        ship_name=#{ship_name},
        ship_mobile=#{ship_mobile},
        ship_province=#{ship_province},
        ship_city=#{ship_city},
        ship_area=#{ship_area},
        ship_addr=#{ship_addr},
        is_use=1,
        uuid=#{uuid}
        WHERE order_number=#{order_number}
    </update>

    <update id="updatePlace" parameterType="com.sftc.web.model.OrderExpress">
        UPDATE sftc_order_express
        set
        longitude=#{longitude},
        latitude=#{latitude},
        is_use=1,
        uuid=#{uuid}
        WHERE order_number=#{order_number}
    </update>

    <update id="updateOrderExpressForSF" parameterType="com.sftc.web.model.OrderExpress">
        update sftc_order_express
        set
        state=#{state}
        WHERE uuid=#{uuid}
    </update>
</mapper>